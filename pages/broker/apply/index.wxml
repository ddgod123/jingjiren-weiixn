<t-toast id="t-toast" />

<view class="broker-apply">
  <t-navbar title="申请成为经纪人" left-arrow bind:left-click="onBack" />
  
  <view class="apply-content">
    <!-- 申请说明 -->
    <view class="apply-notice">
      <t-cell-group theme="card">
        <t-cell>
          <view slot="title" class="notice-title">
            <t-icon name="info-circle" size="32rpx" color="#0052D9" />
            <text class="notice-text">申请说明</text>
          </view>
          <view slot="description" class="notice-content">
            成为经纪人后，您可以管理楼盘信息、发布房源、处理租赁业务等。我们将在1-3个工作日内完成审核。
          </view>
        </t-cell>
      </t-cell-group>
    </view>

    <!-- 申请表单 -->
    <view class="apply-form">
      <t-cell-group theme="card" title="基本信息">
        <!-- 真实姓名 -->
        <t-cell title="真实姓名" required arrow>
          <t-input
            slot="note"
            value="{{formData.realName}}"
            placeholder="请输入您的真实姓名"
            data-field="realName"
            bind:input="onInputChange"
            bind:change="onInputChange"
            clearable
          />
        </t-cell>
        
        <!-- 手机号码 -->
        <t-cell title="手机号码" required arrow>
          <t-input
            slot="note"
            value="{{formData.phone}}"
            placeholder="请输入手机号码"
            type="number"
            maxlength="11"
            data-field="phone"
            bind:input="onInputChange"
            bind:change="onInputChange"
            clearable
          />
        </t-cell>
        
      </t-cell-group>

      <t-cell-group theme="card" title="楼盘信息">
        <!-- 申请楼盘 -->
        <t-cell title="申请楼盘" required arrow bind:click="showBuildingPicker">
          <view slot="note" class="picker-value">
            {{formData.buildingName || '请选择要申请的楼盘'}}
          </view>
        </t-cell>
        
      </t-cell-group>

      <t-cell-group theme="card" title="专业信息（可选）">
        <!-- 所属公司 -->
        <t-cell title="所属公司" arrow>
          <t-input
            slot="note"
            value="{{formData.companyName}}"
            placeholder="请输入所属公司名称"
            data-field="companyName"
            bind:input="onInputChange"
            bind:change="onInputChange"
            clearable
          />
        </t-cell>
        
        <!-- 从业资格证号 -->
        <t-cell title="资格证号" arrow>
          <t-input
            slot="note"
            value="{{formData.licenseNo}}"
            placeholder="请输入从业资格证号"
            data-field="licenseNo"
            bind:input="onInputChange"
            bind:change="onInputChange"
            clearable
          />
        </t-cell>
      </t-cell-group>
    </view>

    <!-- 提交按钮 -->
    <view class="submit-section">
      <view class="submit-buttons">
        <t-button
          theme="primary"
          size="large"
          loading="{{submitting}}"
          disabled="{{!canSubmit || submitting}}"
          bind:tap="onSubmit"
          class="submit-btn"
        >
          {{submitting ? '提交中...' : '提交申请'}}
        </t-button>
      </view>
    </view>
  </view>
</view>


<!-- 楼盘二级选择器 -->
<t-popup 
  visible="{{showBuilding}}" 
  placement="bottom" 
  bind:visible-change="onBuildingPopupChange"
>
  <view class="building-selector">
    <view class="selector-header">
      <text class="selector-title">选择申请楼盘</text>
      <t-icon name="close" size="48rpx" bind:tap="closeBuildingSelector" />
    </view>
    
    <view class="selector-content">
      <!-- 左侧区域列表 -->
      <view class="district-list">
        <view 
          wx:for="{{districtList}}" 
          wx:key="district"
          class="district-item {{selectedDistrict === item.district ? 'active' : ''}}"
          bind:tap="selectDistrict"
          data-district="{{item.district}}"
        >
          <text class="district-name">{{item.district}}</text>
          <text class="building-count">({{item.count}})</text>
        </view>
      </view>
      
      <!-- 右侧楼盘列表 -->
      <view class="building-list">
        <view 
          wx:for="{{currentBuildingList}}" 
          wx:key="id"
          class="building-item {{selectedBuildingId === item.id ? 'selected' : ''}}"
          bind:tap="selectBuilding"
          data-building="{{item}}"
        >
          <view class="building-info">
            <text class="building-name">{{item.name}}</text>
            <text class="building-address">{{item.address}}</text>
          </view>
          <t-icon wx:if="{{selectedBuildingId === item.id}}" name="check" color="#0052d9" size="32rpx" />
        </view>
      </view>
    </view>
    
    <!-- 底部确认按钮 -->
    <view class="selector-footer">
      <t-button 
        variant="outline" 
        size="large" 
        bind:tap="closeBuildingSelector"
        class="cancel-btn"
      >
        取消
      </t-button>
      <t-button 
        theme="primary" 
        size="large" 
        bind:tap="confirmBuildingSelection"
        class="confirm-btn"
        disabled="{{!selectedBuildingId}}"
      >
        确认选择
      </t-button>
    </view>
  </view>
</t-popup>
